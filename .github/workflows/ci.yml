name: CI

on:
  schedule:
    # ë§¤ì¼ 11:00 UTC (KST 20:00, ET 06:00)
    - cron: "0 11 * * *"
    # ë§¤ì¼ 23:00 UTC (KST 08:00+1, ET 18:00)
    - cron: "0 23 * * *"
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ì§€ì› (Manual trigger supported)
  pull_request:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Install all skills (local)
        run: |
          npx skills add . --yes
          echo "âœ… Successfully installed all skills from local repository"

      - name: Verify all skill files
        run: |
          echo "ğŸ“ Checking installed skill files..."

          SKILLS_DIR=".agents/skills"

          if [ ! -d "$SKILLS_DIR" ]; then
            echo "âŒ Skills directory not found: $SKILLS_DIR"
            exit 1
          fi

          echo "âœ… Skills directory exists: $SKILLS_DIR"

          # ì„¤ì¹˜ëœ ëª¨ë“  ìŠ¤í‚¬ í™•ì¸
          SKILL_COUNT=0
          for skill_dir in "$SKILLS_DIR"/*; do
            if [ -d "$skill_dir" ]; then
              skill_name=$(basename "$skill_dir")
              echo ""
              echo "ğŸ“¦ Checking skill: $skill_name"

              if [ -f "$skill_dir/SKILL.md" ]; then
                echo "  âœ… Found SKILL.md"
                SKILL_COUNT=$((SKILL_COUNT + 1))
              else
                echo "  âŒ SKILL.md not found in $skill_dir"
                exit 1
              fi
            fi
          done

          echo ""
          echo "âœ… Successfully verified $SKILL_COUNT skills"

          # ìµœì†Œ 1ê°œ ì´ìƒì˜ ìŠ¤í‚¬ì´ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if [ $SKILL_COUNT -eq 0 ]; then
            echo "âŒ No skills were installed"
            exit 1
          fi

  test-remote:
    runs-on: ubuntu-latest
    # main ë¸Œëœì¹˜ì— mergeëœ í›„ì—ë§Œ ì‹¤í–‰
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Install all skills from Skills.sh
        run: |
          npx skills add DaleStudy/skills --yes
          echo "âœ… Successfully installed all skills from GitHub"

      - name: Verify all skill files
        run: |
          echo "ğŸ“ Checking installed skill files..."

          SKILLS_DIR=".agents/skills"

          if [ ! -d "$SKILLS_DIR" ]; then
            echo "âŒ Skills directory not found: $SKILLS_DIR"
            exit 1
          fi

          echo "âœ… Skills directory exists: $SKILLS_DIR"

          # ì„¤ì¹˜ëœ ëª¨ë“  ìŠ¤í‚¬ í™•ì¸
          SKILL_COUNT=0
          for skill_dir in "$SKILLS_DIR"/*; do
            if [ -d "$skill_dir" ]; then
              skill_name=$(basename "$skill_dir")
              echo ""
              echo "ğŸ“¦ Checking skill: $skill_name"

              if [ -f "$skill_dir/SKILL.md" ]; then
                echo "  âœ… Found SKILL.md"
                SKILL_COUNT=$((SKILL_COUNT + 1))
              else
                echo "  âŒ SKILL.md not found in $skill_dir"
                exit 1
              fi
            fi
          done

          echo ""
          echo "âœ… Successfully verified $SKILL_COUNT skills"

          # ìµœì†Œ 1ê°œ ì´ìƒì˜ ìŠ¤í‚¬ì´ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if [ $SKILL_COUNT -eq 0 ]; then
            echo "âŒ No skills were installed"
            exit 1
          fi
