name: Validate Skills Installation

on:
  schedule:
    # ë§¤ì¼ 11:00 UTC (KST 20:00, ET 06:00)
    - cron: "0 11 * * *"
    # ë§¤ì¼ 23:00 UTC (KST 08:00+1, ET 18:00)
    - cron: "0 23 * * *"
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ì§€ì›
  push:
    branches: [main]
    paths:
      - "skills/*/SKILL.md"
  pull_request:
    branches: [main]
    paths:
      - "skills/*/SKILL.md"

jobs:
  validate:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    timeout-minutes: 10

    strategy:
      fail-fast: false
      matrix:
        skill:
          - bun
          - github-actions

    steps:
      - name: Create Claude Code config directory
        run: mkdir -p ~/.claude

      - name: Validate ${{ matrix.skill }} installation
        run: |
          npx add-skill DaleStudy/skills \
            --skill ${{ matrix.skill }} \
            --agent claude-code \
            --global \
            --yes
          echo "âœ… Successfully installed skill: ${{ matrix.skill }}"

      - name: Verify skill files
        run: |
          echo "ðŸ“ Checking installed skill files..."

          # add-skillì€ ~/.agents/skills/ì— ì„¤ì¹˜í•˜ê³  ê° ì—ì´ì „íŠ¸ë¡œ symlink ìƒì„±
          SKILL_DIR="$HOME/.agents/skills/${{ matrix.skill }}"

          if [ -d "$SKILL_DIR" ]; then
            echo "âœ… Skill directory exists: $SKILL_DIR"
            ls -la "$SKILL_DIR"

            if [ -f "$SKILL_DIR/SKILL.md" ]; then
              echo "âœ… Found SKILL.md"
              echo "--- Content preview ---"
              head -20 "$SKILL_DIR/SKILL.md"
            else
              echo "âŒ SKILL.md not found in $SKILL_DIR"
              exit 1
            fi
          else
            echo "âŒ Skill directory not found: $SKILL_DIR"
            echo "Searching for installed skills:"
            find ~/.agents -type d 2>/dev/null || echo "~/.agents not found"
            find ~/.claude -type l 2>/dev/null || echo "No symlinks in ~/.claude"
            exit 1
          fi
