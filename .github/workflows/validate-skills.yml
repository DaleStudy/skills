name: Validate Skills Installation

on:
  schedule:
    # ë§¤ì¼ 11:00 UTC (KST 20:00, ET 06:00)
    - cron: "0 11 * * *"
    # ë§¤ì¼ 23:00 UTC (KST 08:00+1, ET 18:00)
    - cron: "0 23 * * *"
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ì§€ì›
  push:
    branches: [main]
    paths:
      - "skills/*/SKILL.md"
  pull_request:
    branches: [main]
    paths:
      - "skills/*/SKILL.md"

jobs:
  validate:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    timeout-minutes: 10

    strategy:
      fail-fast: false
      matrix:
        skill:
          - bun
          - github-actions

    steps:
      - name: Create Claude Code config directory
        run: mkdir -p ~/.claude

      - name: Validate ${{ matrix.skill }} installation
        run: |
          npx add-skill DaleStudy/skills \
            --skill ${{ matrix.skill }} \
            --agent claude-code \
            --global \
            --yes
          echo "âœ… Successfully installed skill: ${{ matrix.skill }}"

      - name: Verify skill files
        run: |
          echo "ðŸ“ Checking installed skill files..."

          # Claude Code ìŠ¤í‚¬ ë””ë ‰í† ë¦¬ í™•ì¸
          if [ -d "$HOME/.claude" ]; then
            echo "Contents of ~/.claude:"
            find ~/.claude -type f -name "*.md" | head -20
          fi

          # SKILL.md íŒŒì¼ ì¡´ìž¬ í™•ì¸
          SKILL_FILE=$(find ~/.claude -type f -name "SKILL.md" 2>/dev/null | grep -i "${{ matrix.skill }}" | head -1)
          if [ -n "$SKILL_FILE" ]; then
            echo "âœ… Found skill file: $SKILL_FILE"
            echo "--- Content preview ---"
            head -20 "$SKILL_FILE"
          else
            echo "âŒ Skill file not found for: ${{ matrix.skill }}"
            echo "Searching in ~/.claude for any files:"
            find ~/.claude -type f 2>/dev/null || echo "No files found"
            exit 1
          fi
